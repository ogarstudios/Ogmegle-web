<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gorilla Tag WebGL</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script>
        // Scene Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Create a basic cube to represent the player
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        const player = new THREE.Mesh(geometry, material);
        scene.add(player);

        // Create hands (spheres)
        const handGeometry = new THREE.SphereGeometry(0.3, 32, 32);
        const handMaterial = new THREE.MeshBasicMaterial({ color: 0x0000ff });
        const leftHand = new THREE.Mesh(handGeometry, handMaterial);
        const rightHand = new THREE.Mesh(handGeometry, handMaterial);

        // Attach hands to player
        player.add(leftHand);
        player.add(rightHand);

        // Position hands
        leftHand.position.set(-0.8, 0, 0); // Left hand (to the left of the player)
        rightHand.position.set(0.8, 0, 0); // Right hand (to the right of the player)

        // Create a floor
        const floorGeometry = new THREE.PlaneGeometry(100, 100); // Larger plane for the floor
        const floorMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa, side: THREE.DoubleSide });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = - Math.PI / 2; // Rotate the floor to be flat
        floor.position.y = -1; // Position the floor below the player
        scene.add(floor);

        camera.position.z = 5;

        // Simple movement setup
        let mouseX = 0;
        let mouseY = 0;

        // Gravity and movement variables
        let gravity = -0.1; // Gravity force
        let velocity = { x: 0, y: 0 }; // Velocity of the player (x, y)

        // Event Listener for mouse movement
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
        });

        // Create a bounding box for the player
        const playerBox = new THREE.Box3().setFromObject(player);
        const leftHandBox = new THREE.Box3().setFromObject(leftHand);
        const rightHandBox = new THREE.Box3().setFromObject(rightHand);
        const floorBox = new THREE.Box3().setFromObject(floor);

        // Check if objects collide
        function checkCollision() {
            // Check if player collides with the floor
            if (playerBox.intersectsBox(floorBox)) {
                player.position.y = -1; // Prevent the player from falling below the floor
                velocity.y = 0; // Stop downward velocity when hitting the floor
            }

            // Check if hands collide with the floor
            if (leftHandBox.intersectsBox(floorBox)) {
                leftHand.position.y = -1; // Prevent the left hand from going through the floor
            }
            if (rightHandBox.intersectsBox(floorBox)) {
                rightHand.position.y = -1; // Prevent the right hand from going through the floor
            }
        }

        // Apply gravity to the player and check for collision with the floor
        function applyGravity() {
            if (player.position.y > -1) {
                velocity.y += gravity; // Apply gravity
            } else {
                player.position.y = -1; // Ensure the player stays on the ground
                velocity.y = 0; // Stop downward movement when hitting the floor
            }
        }

        // Update the bounding boxes for the player and hands
        function updateBoundingBoxes() {
            playerBox.setFromObject(player);
            leftHandBox.setFromObject(leftHand);
            rightHandBox.setFromObject(rightHand);
        }

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);

            // Move the player based on mouse position (horizontal movement only)
            player.position.x = mouseX * 5; // Scale movement speed for horizontal axis
            player.position.z = mouseY * 5; // Use Y from mouse to move on the Z-axis
            player.position.y = Math.max(player.position.y, -1); // Prevent vertical movement from mouse

            // Move hands based on player's movement
            leftHand.position.x = player.position.x - 0.8;
            rightHand.position.x = player.position.x + 0.8;
            leftHand.position.z = player.position.z;
            rightHand.position.z = player.position.z;
            leftHand.position.y = player.position.y;
            rightHand.position.y = player.position.y;

            // Apply gravity to the player and check collision with the floor
            applyGravity();

            // Check for collisions (player and hands with floor)
            checkCollision();

            // Update bounding boxes after position changes
            updateBoundingBoxes();

            // Update the camera to follow the player
            camera.position.x = player.position.x;
            camera.position.y = player.position.y + 2;
            camera.position.z = player.position.z + 5;

            renderer.render(scene, camera);
        }

        animate();

    </script>
</body>
</html>
